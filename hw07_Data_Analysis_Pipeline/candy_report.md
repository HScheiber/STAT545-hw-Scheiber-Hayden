Homework 7 - Data Analysis Pipeline
================
Hayden Scheiber -
11 November, 2017

[Return to Main Page](https://github.com/HScheiber/STAT545-hw-Scheiber-Hayden/blob/master/README.md)

[Return to Homework 7 Landing Page](README.md)

------------------------------------------------------------------------

-   [Downloading and Cleaning the Data](#downloading-and-cleaning-the-data)
-   [Manipulating the Data](#manipulating-the-data)
-   [Plotting the Data](#plotting-the-data)
-   [One Script to Rule Them All](#one-script-to-rule-them-all)

------------------------------------------------------------------------

Welcome! This is the 7th homework assignment for the STAT 545+547M course. In this assignment, I build an automated data analysis pipline using the program `GNU Make`. A link to the assignment itself can be found [here](http://stat545.com/hw07_automation.html "STAT 545 Assignment 7").

------------------------------------------------------------------------

For this assignment, I decided that I was bored of exploring the gapminder data. So I tried my hand at exploring the [2015 candy survey data](http://www.scq.ubc.ca/2015-candy-hierarchy-supplemental-raw-data-and-new-analyses/), which I did not explore for assignment 6. Below are the libraries needed to run this R markdown file:

``` r
suppressPackageStartupMessages(library(tidyverse))
```

    ## Warning: package 'tidyverse' was built under R version 3.4.2

``` r
suppressPackageStartupMessages(library(knitr))
```

Downloading and Cleaning the Data
---------------------------------

<a href="#top">Back to top</a>

To initially download the candy survey data, I used a short Rscript command within my [Makefile](Makefile). The excel spreadsheet data is downloaded into the subdirectory called `DataFiles`, to keep things neat.

From there, I call the first real R script called [Clean\_candy\_data.r](Clean_candy_data.r). In that script, I take the ugly excel spreadsheet and remove the questions I didn't feel like working with. I only kept the data about people's candy preferences and their age. I converted the strings `JOY/DESPAIR` into logical `TRUE/FALSE` so that it would be easier to work with. Below I show the structure of the output file of this script, which I saved as a `.rds` file.

``` r
candies_clean <- readRDS("./DataFiles/Clean_candy_wide.rds")
str(candies_clean, max.level = 1, list.len=10 ) %>% head(10)
```

    ## Classes 'tbl_df', 'tbl' and 'data.frame':    5630 obs. of  98 variables:
    ##  $ Time                                                                                  : POSIXct, format: "2015-10-23 08:46:20" "2015-10-23 08:46:51" ...
    ##  $ Age                                                                                   : int  35 41 33 31 30 38 48 39 NA 54 ...
    ##  $ Going                                                                                 : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
    ##  $ Butterfinger                                                                          : logi  TRUE TRUE FALSE TRUE NA TRUE ...
    ##  $ 100_Grand_Bar                                                                         : logi  NA TRUE FALSE TRUE TRUE TRUE ...
    ##  $ Anonymous_brown_globs_that_come_in_black_and_orange_wrappers                          : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
    ##  $ Any_full-sized_candy_bar                                                              : logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
    ##  $ Black_Jacks                                                                           : logi  NA FALSE FALSE FALSE NA FALSE ...
    ##  $ Bonkers                                                                               : logi  NA FALSE FALSE FALSE NA TRUE ...
    ##  $ Bottle_Caps                                                                           : logi  NA TRUE FALSE TRUE NA TRUE ...
    ##   [list output truncated]

    ## NULL

Manipulating the Data
---------------------

<a href="#top">Back to top</a>

The next script, called [Manipulate\_candy\_data.r](Manipulate_candy_data.r), takes the output of the previous script and converts the data into two different data frames. One is broken down by age, and shows the ratio of people who wrote `JOY` vs `DESPAIR` for each candy. The other data frame does not group by age. It is simply a long data frame of the total Joy-Despair Ratio for each candy type. Below I show a glimpse of how the outputs look:

``` r
candies_grouped <- readRDS("./DataFiles/Ratios_Group_Age.rds")
candies_ungrouped <- readRDS("./DataFiles/Ratios_No_Group.rds")

candies_grouped %>% head(10) %>%
    knitr::kable()
```

|                                                                       |    5|     6|    7|          8|          9|    10|         11|         12|         13|         14|         15|         16|         17|         18|         19|         20|         21|         22|         23|         24|         25|         26|         27|         28|         29|         30|         31|         32|         33|         34|         35|         36|         37|         38|         39|         40|         41|         42|         43|         44|         45|         46|         47|         48|         49|         50|         51|         52|         53|         54|         55|         56|         57|         58|         59|         60|         61|         62|         63|         64|         65|         66|         67|   68|         69|         70|    71|    72|         74|         75|   77|   85|   97|   99|  100|
|-----------------------------------------------------------------------|----:|-----:|----:|----------:|----------:|-----:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----------:|----:|----------:|----------:|-----:|-----:|----------:|----------:|----:|----:|----:|----:|----:|
| Butterfinger                                                          |    1|  1.00|  0.5|  1.0000000|  0.6666667|  0.80|  0.6250000|  0.9166667|  0.5714286|  0.4615385|  0.5000000|  0.7000000|  0.6296296|  0.6216216|  0.7179487|  0.8292683|  0.6851852|  0.7428571|  0.7837838|  0.7524752|  0.8272727|  0.7583893|  0.7771084|  0.7937500|  0.7894737|  0.8311111|  0.8275862|  0.7695853|  0.8292683|  0.8743719|  0.7920354|  0.7857143|  0.7770270|  0.8200000|  0.7672414|  0.8344828|  0.7818182|  0.7457627|  0.8189655|  0.7685950|  0.8131868|  0.8250000|  0.7777778|  0.6857143|  0.8208955|  0.7415730|  0.7230769|  0.7000000|  0.8888889|  0.9183673|  0.8260870|  0.8125000|  0.8095238|  0.7608696|  0.6956522|  0.7600000|  0.8235294|  0.8695652|  0.7500000|  0.5000000|  0.6000000|  0.8333333|  0.8750000|  0.6|  0.6666667|  0.7777778|  1.00|  0.50|  1.0000000|  1.0000000|    1|    1|    1|    1|  1.0|
| 100\_Grand\_Bar                                                       |    0|  1.00|  1.0|  0.3333333|  0.6250000|  0.25|  0.6666667|  0.8000000|  0.3157895|  0.5000000|  0.5000000|  0.3529412|  0.4000000|  0.4375000|  0.4444444|  0.6578947|  0.5370370|  0.6666667|  0.5588235|  0.5757576|  0.5619048|  0.5539568|  0.6666667|  0.6762590|  0.7151515|  0.6586538|  0.6482412|  0.6386139|  0.6612903|  0.7150538|  0.6682028|  0.7517730|  0.6971831|  0.6830986|  0.7217391|  0.7310345|  0.7570093|  0.8000000|  0.8495575|  0.7583333|  0.7640449|  0.8067227|  0.7361111|  0.8142857|  0.7460317|  0.7065217|  0.8064516|  0.7826087|  0.8431373|  0.7872340|  0.8444444|  0.6285714|  0.7631579|  0.7380952|  0.7142857|  0.5238095|  0.7058824|  0.7727273|  0.9166667|  0.6666667|  0.6923077|  0.5833333|  0.4615385|  0.5|  0.5555556|  0.5714286|  0.25|  0.75|  0.6666667|  1.0000000|    1|    1|    1|    1|  1.0|
| Anonymous\_brown\_globs\_that\_come\_in\_black\_and\_orange\_wrappers |    1|  0.00|  0.0|  0.2500000|  0.1250000|  0.00|  0.1250000|  0.0833333|  0.0952381|  0.0714286|  0.2222222|  0.1000000|  0.1481481|  0.2571429|  0.1000000|  0.1627907|  0.1403509|  0.1126761|  0.1388889|  0.1132075|  0.0366972|  0.0915033|  0.0946746|  0.1012658|  0.0941176|  0.0701754|  0.0526316|  0.0727273|  0.1100478|  0.1094527|  0.1068376|  0.1273885|  0.1192053|  0.1241830|  0.0909091|  0.0838710|  0.0370370|  0.0991736|  0.1355932|  0.1076923|  0.1381215|  0.0819672|  0.1204819|  0.0821918|  0.1764706|  0.0625000|  0.1111111|  0.0833333|  0.1372549|  0.1020408|  0.1666667|  0.1142857|  0.1860465|  0.1276596|  0.1250000|  0.0800000|  0.0666667|  0.0416667|  0.0833333|  0.3571429|  0.0000000|  0.0000000|  0.0000000|  0.0|  0.3333333|  0.1428571|  0.00|  0.25|  0.0000000|  0.0000000|    0|    0|    1|    0|  0.0|
| Any\_full-sized\_candy\_bar                                           |    1|  1.00|  0.5|  1.0000000|  0.8888889|  1.00|  1.0000000|  0.9166667|  0.8571429|  0.9285714|  0.9000000|  0.9000000|  1.0000000|  0.9473684|  0.9250000|  0.9555556|  0.9491525|  0.9295775|  0.9078947|  0.9181818|  0.9649123|  0.9607843|  0.9349112|  0.9740260|  0.9651163|  0.9432314|  0.9289100|  0.9409091|  0.9375000|  0.9516908|  0.9353448|  0.9562500|  0.9411765|  0.9539474|  0.9000000|  0.9407895|  0.9082569|  0.8852459|  0.9327731|  0.9685039|  0.9405405|  0.9000000|  0.9500000|  0.9722222|  0.9531250|  0.8369565|  0.8730159|  0.9041096|  0.9272727|  0.9411765|  0.9347826|  0.8181818|  0.9268293|  0.8723404|  0.9523810|  0.7916667|  0.9411765|  1.0000000|  0.8461538|  0.8125000|  0.8666667|  0.7272727|  0.8750000|  0.8|  0.6666667|  0.8750000|  0.80|  1.00|  0.6666667|  1.0000000|    1|    1|    1|    1|  1.0|
| Black\_Jacks                                                          |    1|  0.00|  0.0|        NaN|  0.1250000|  0.00|  0.2500000|  0.0909091|  0.0000000|  0.0000000|  0.1111111|  0.1578947|  0.0952381|  0.1481481|  0.0312500|  0.0571429|  0.1000000|  0.0000000|  0.0312500|  0.0561798|  0.0120482|  0.0495868|  0.0496454|  0.0314961|  0.0354610|  0.0456853|  0.0213904|  0.0486486|  0.0674157|  0.0473373|  0.0541872|  0.1000000|  0.0746269|  0.0895522|  0.1078431|  0.0895522|  0.0679612|  0.0648148|  0.1142857|  0.0934579|  0.0710059|  0.0550459|  0.0833333|  0.1492537|  0.0983607|  0.0879121|  0.1206897|  0.0909091|  0.1836735|  0.1666667|  0.1363636|  0.0344828|  0.1315789|  0.0714286|  0.2105263|  0.1250000|  0.1250000|  0.0869565|  0.1666667|  0.2142857|  0.0666667|  0.1818182|  0.0769231|  0.4|  0.0000000|  0.2500000|  0.00|  0.25|  0.0000000|  0.5000000|    0|    0|    0|    0|  0.0|
| Bonkers                                                               |    0|  0.00|  0.0|  0.0000000|  0.3750000|  0.25|  0.5000000|  0.0000000|  0.0588235|  0.0000000|  0.0000000|  0.0526316|  0.1904762|  0.0769231|  0.0000000|  0.0312500|  0.1086957|  0.0175439|  0.0312500|  0.0705882|  0.0864198|  0.0508475|  0.0454545|  0.0826446|  0.0647482|  0.0594595|  0.0635838|  0.1067416|  0.1657143|  0.2256098|  0.1958763|  0.2406015|  0.2388060|  0.2230769|  0.1500000|  0.2480620|  0.0824742|  0.2095238|  0.1632653|  0.0824742|  0.1132075|  0.1090909|  0.1428571|  0.0967742|  0.1016949|  0.1111111|  0.1206897|  0.0769231|  0.1555556|  0.1463415|  0.0227273|  0.0000000|  0.0555556|  0.0487805|  0.0555556|  0.0869565|  0.1333333|  0.1304348|  0.0000000|  0.0000000|  0.0000000|  0.0000000|  0.0000000|  0.0|  0.1111111|  0.0000000|  0.00|  0.00|  0.0000000|  0.0000000|    0|    0|    0|    0|  0.0|
| Bottle\_Caps                                                          |    0|  0.00|  0.0|  1.0000000|  0.6666667|  0.60|  0.8571429|  0.2727273|  0.6666667|  0.7000000|  0.5000000|  0.3500000|  0.4090909|  0.5000000|  0.5675676|  0.3076923|  0.3818182|  0.4225352|  0.3750000|  0.3684211|  0.4455446|  0.3623188|  0.4166667|  0.3851351|  0.3987342|  0.4331797|  0.3888889|  0.3714286|  0.4623116|  0.3837838|  0.4311927|  0.4765101|  0.4825175|  0.4166667|  0.3865546|  0.5133333|  0.4587156|  0.4655172|  0.4587156|  0.5042735|  0.5168539|  0.4833333|  0.4303797|  0.4929577|  0.5000000|  0.4680851|  0.3934426|  0.3134328|  0.5000000|  0.2666667|  0.1111111|  0.2068966|  0.1315789|  0.1162791|  0.1500000|  0.1363636|  0.0666667|  0.1739130|  0.0000000|  0.0000000|  0.1818182|  0.0000000|  0.0000000|  0.0|  0.1111111|  0.1666667|  0.00|  0.00|  0.0000000|  0.0000000|    0|    1|    0|    0|  0.5|
| Box’o’\_Raisins                                                       |    0|  0.00|  0.0|  0.2500000|  0.2222222|  0.20|  0.1428571|  0.0000000|  0.1904762|  0.1428571|  0.1000000|  0.0500000|  0.1111111|  0.2058824|  0.1951220|  0.1190476|  0.1166667|  0.1666667|  0.1891892|  0.1509434|  0.0747664|  0.0860927|  0.1294118|  0.0784314|  0.0828402|  0.0740741|  0.1111111|  0.1079812|  0.1707317|  0.0837696|  0.0852018|  0.0405405|  0.0723684|  0.1140940|  0.0932203|  0.1184211|  0.0467290|  0.0756303|  0.0948276|  0.1229508|  0.0714286|  0.0416667|  0.1125000|  0.1111111|  0.1230769|  0.1894737|  0.0806452|  0.1250000|  0.1600000|  0.1800000|  0.1777778|  0.1891892|  0.1707317|  0.1333333|  0.1304348|  0.3043478|  0.3750000|  0.2083333|  0.1666667|  0.0833333|  0.2857143|  0.2500000|  0.1428571|  0.2|  0.1111111|  0.2500000|  0.00|  0.50|  1.0000000|  0.3333333|    0|    0|    1|    0|  0.0|
| Brach\_products\_(not\_including\_candy\_corn)                        |    1|  0.50|  0.0|  0.5000000|  0.5000000|  0.40|  0.1666667|  0.5833333|  0.3684211|  0.2222222|  0.3333333|  0.3500000|  0.3181818|  0.3000000|  0.2500000|  0.1081081|  0.2407407|  0.2307692|  0.1515152|  0.1368421|  0.2164948|  0.1538462|  0.1974522|  0.1678322|  0.1898734|  0.1990291|  0.1979695|  0.2178218|  0.1957672|  0.2234043|  0.1834862|  0.2191781|  0.2708333|  0.2086331|  0.2410714|  0.2112676|  0.2761905|  0.2181818|  0.2363636|  0.2966102|  0.2781065|  0.2307692|  0.1923077|  0.1408451|  0.3492063|  0.2446809|  0.2666667|  0.3088235|  0.2244898|  0.3191489|  0.3478261|  0.3030303|  0.2702703|  0.2500000|  0.1363636|  0.3913043|  0.2941176|  0.1739130|  0.0000000|  0.2142857|  0.3333333|  0.3636364|  0.4285714|  0.4|  0.2222222|  0.3333333|  0.00|  0.50|  1.0000000|  0.6666667|    1|    0|    1|    1|  0.0|
| Bubble\_Gum                                                           |    1|  0.75|  0.5|  0.7500000|  0.6250000|  1.00|  0.8571429|  0.4166667|  0.7894737|  0.6153846|  0.5555556|  0.5500000|  0.4444444|  0.5588235|  0.3947368|  0.3333333|  0.4385965|  0.2857143|  0.3239437|  0.3267327|  0.3551402|  0.3402778|  0.2603550|  0.2550336|  0.2046784|  0.2442396|  0.2475728|  0.2046512|  0.2350000|  0.2894737|  0.1718062|  0.1933333|  0.2094595|  0.2397260|  0.2500000|  0.2739726|  0.2110092|  0.3083333|  0.2300885|  0.3247863|  0.2768362|  0.1833333|  0.2467532|  0.2857143|  0.3230769|  0.3444444|  0.2968750|  0.2535211|  0.2941176|  0.3061224|  0.2708333|  0.3142857|  0.2926829|  0.2173913|  0.3043478|  0.2173913|  0.2941176|  0.2173913|  0.0833333|  0.0714286|  0.3125000|  0.0000000|  0.2000000|  0.4|  0.2222222|  0.1250000|  0.20|  0.25|  0.3333333|  0.0000000|    1|    0|    0|    1|  0.5|

``` r
candies_ungrouped %>% head(10) %>%
    knitr::kable()
```

| Candy                                                                              |  Joy\_Despair\_Ratio|
|:-----------------------------------------------------------------------------------|--------------------:|
| Broken\_glow\_stick                                                                |            0.0193182|
| Candy\_that\_is\_clearly\_just\_the\_stuff\_given\_out\_for\_free\_at\_restaurants |            0.0433131|
| Gum\_from\_baseball\_cards                                                         |            0.0539915|
| White\_Bread                                                                       |            0.0539996|
| JoyJoy\_(Mit\_Iodine)                                                              |            0.0550089|
| Kale\_smoothie                                                                     |            0.0576590|
| Spotted\_Dick                                                                      |            0.0624071|
| Dental\_paraphenalia                                                               |            0.0680015|
| Black\_Jacks                                                                       |            0.0730761|
| Whole\_Wheat\_anything                                                             |            0.0897514|

Plotting the Data
-----------------

<a href="#top">Back to top</a>

My last workhorse script is called [Plot\_candy\_data.r](Plot_candy_data.r). It takes the input from the previous script, does a little bit more data rearrangement, and then creates two beautiful plots. If you want to understand how the script works, it is best to just look at it. I tried to comment it as best as I could. Here are the two plots that I created using that script.

!['Candy Popularity by Type'](DataFiles/CandyPop_By_Candy.png)

From this we can conclude that everyone's favorite candy to get on Halloween is a full-sized chocolate bar. Everyone's least favourite thing is a broken glow stick.

!['Candy Popularity by Age and Type'](DataFiles/CandyPop_By_Age_Candy.png)

One Script to Rule Them All
---------------------------

<a href="#top">Back to top</a>

To tie everything together, I also made a `Makefile` script that automates the entire data analysis process. You can view it [here](Makefile).
